<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.voc.vocapi.voc.mapper.VocCustMapper">

    <!-- 고객정보 목록 조회 -->
    <select id="getVocCustList" resultType="kr.co.voc.vocapi.voc.dto.VocCustDto$Info">
        SELECT cust_seq             AS "custSeq",
               hotel_cd             AS "hotelCd",
               cust_no              AS "custNo",
               cust_nm              AS "custNm",
               cust_nm_en           AS "custNmEn",
               tel_no               AS "telNo",
               email_addr           AS "emailAddr",
               del_yn               AS "delYn",
               reg_user_no          AS "regUserNo",
               reg_dt               AS "regDt",
               mod_user_no          AS "modUserNo",
               mod_dt               AS "modDt"
          FROM tb_voc_cust
         WHERE del_yn = 'N'
            <if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(p.custSeq)">AND cust_seq = #{p.custSeq} </if>
            <if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(p.hotelCd)">AND hotel_cd = #{p.hotelCd} </if>
            <if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(p.custNo)">AND cust_no = #{p.custNo} </if>
            <if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(p.custNm)">AND cust_nm LIKE CONCAT('%',#{p.custNm},'%') </if>
            <if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(p.custNmEn)">AND cust_nm_en LIKE CONCAT('%',#{p.custNmEn},'%') </if>
            <if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(p.telNo)">AND tel_no = #{p.telNo} </if>
         ORDER BY cust_seq DESC
         <if test="offset &gt; -1">
         LIMIT #{offset}, #{length}
         </if>
    </select>
    <select id="getVocCustListCount" resultType="long">
        SELECT COUNT(1)
          FROM tb_voc_cust
         WHERE del_yn = 'N'
            <if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(custSeq)">AND cust_seq = #{custSeq} </if>
            <if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(hotelCd)">AND hotel_cd = #{hotelCd} </if>
            <if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(custNo)">AND cust_no = #{custNo} </if>
            <if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(custNm)">AND cust_nm LIKE CONCAT('%',#{custNm},'%') </if>
            <if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(custNmEn)">AND cust_nm_en LIKE CONCAT('%',#{custNmEn},'%') </if>
            <if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(telNo)">AND tel_no = #{telNo} </if>
    </select>

	<!-- 고객정보 상세 조회 -->
    <select id="getVocCust" resultType="kr.co.voc.vocapi.voc.dto.VocCustDto$Info">
        SELECT cust_seq             AS "custSeq",
               hotel_cd             AS "hotelCd",
               cust_no              AS "custNo",
               cust_nm              AS "custNm",
               cust_nm_en           AS "custNmEn",
               tel_no               AS "telNo",
               email_addr           AS "emailAddr",
               del_yn               AS "delYn",
               reg_user_no          AS "regUserNo",
               reg_dt               AS "regDt",
               mod_user_no          AS "modUserNo",
               mod_dt               AS "modDt"
          FROM tb_voc_cust A
         WHERE cust_seq = #{custSeq}
           AND del_yn = 'N'
    </select>

	<!-- 고객정보 등록 -->
    <insert id="insertVocCust">
        INSERT INTO tb_voc_cust
        (
            hotel_cd,
            cust_no,
            cust_nm,
            cust_nm_en,
            tel_no,
            email_addr,
            reg_user_no,
            mod_user_no
        )
        VALUES
        (
            #{hotelCd},
            (SELECT * FROM ( SELECT CONCAT(#{hotelCd}, '_', LPAD(IFNULL(COUNT(1), 0) + 1, 4, '0')) FROM tb_voc_cust WHERE hotel_cd=#{hotelCd} ) AS cust_no),
            #{custNm},
            #{custNmEn},
            #{telNo},
            #{emailAddr},
            #{regUserNo},
            #{modUserNo}
         )
        <selectKey resultType="int" keyProperty="returnKey" order="AFTER">
            SELECT LAST_INSERT_ID()
        </selectKey>
    </insert>

    <!-- 고객정보 수정 -->
    <update id="updateVocCust">
        UPDATE tb_voc_cust SET
            hotel_cd             = #{hotelCd},
            cust_no              = #{custNo},
            cust_nm              = #{custNm},
            cust_nm_en           = #{custNmEn},
            tel_no               = #{telNo},
            email_addr           = #{emailAddr},
            mod_user_no          = #{modUserNo}
        WHERE cust_seq=#{custSeq}
    </update>

	<!-- 고객정보 삭제 -->
    <update id="deleteVocCust">
        UPDATE tb_voc_cust
           SET del_yn = 'Y'
         WHERE cust_seq=#{custSeq}
    </update>

</mapper>
